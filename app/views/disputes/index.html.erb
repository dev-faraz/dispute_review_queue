<div class="max-w-7xl mx-auto p-6">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Dispute Review Queue</h1>
    <div class="text-sm text-gray-600">
      Logged in as: <strong><%= current_user.email %></strong>
      (<%= current_user.role.humanize %>)
    </div>
    <div class="flex gap-4 border-l pl-6 border-gray-300">
      <%= link_to reports_daily_volume_path,
            class: "flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium shadow-sm" do %>
        Chart Daily Volume
      <% end %>
      <br/>

      <%= link_to reports_time_to_decision_path,
            class: "flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition font-medium shadow-sm" do %>
        Time to Decision (p50/p90)
      <% end %>
    </div>
  </div>

  <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
    <% totals = Dispute.group(:status).count %>
    <% [
      ["needs_response", "Needs Response", "bg-orange-500"],
      ["under_review",   "Under Review",   "bg-blue-500"],
      ["won",            "Won",            "bg-green-500"],
      ["lost",           "Lost",           "bg-red-500"],
      [nil,              "Total",          "bg-gray-600"]
    ].each do |status, label, color| %>
      <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-3xl font-bold text-gray-900">
          <%= status ? (totals[status.to_s] || 0) : Dispute.count %>
        </div>
        <div class="text-sm text-gray-600 mt-1"><%= label %></div>
        <div class="mt-2 w-full h-3 <%= color %> rounded"></div>
      </div>
    <% end %>
  </div>

  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dispute ID</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Charge</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Opened</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% @disputes.each do |dispute| %>
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">
                <%= link_to dispute.external_id, dispute, class: "text-indigo-600 hover:text-indigo-900" %>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              <%= dispute.charge.external_id %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold">
              <%= number_to_currency(dispute.amount_cents.to_i / 100.0) %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full
                <%= case dispute.status
                    when 'needs_response' then 'bg-orange-100 text-orange-800'
                    when 'under_review'   then 'bg-blue-100 text-blue-800'
                    when 'won'            then 'bg-green-100 text-green-800'
                    when 'lost'           then 'bg-red-100 text-red-800'
                    end %>">
                <%= dispute.status.humanize %>
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= user_date(dispute.opened_at) %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <% if policy(dispute).show? %>
                <%= link_to "View", dispute, class: "text-indigo-600 hover:text-indigo-900 mr-4" %>
              <% end %>
              <% if policy(dispute).transition? %>
                <span class="text-green-600 font-medium">Ready to act</span>
              <% else %>
                <span class="text-gray-400">View only</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% if @disputes.empty? %>
      <div class="text-center py-12 text-gray-500">
        No disputes found. You're all caught up!
      </div>
    <% end %>
  </div>
</div>